# =============================================================================
# CHAT SERVICE - Environment Variables
# Port: 3002
# =============================================================================
#
# Copy this file to .env and fill in your values
# Most variables can be inherited from root .env file
#
# =============================================================================

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================
PORT=3002
NODE_ENV=development
LOG_LEVEL=info

# =============================================================================
# DATABASE - PostgreSQL
# =============================================================================
# PostgreSQL connection URL (REQUIRED)
DATABASE_URL=postgresql://postgres:password@localhost:5432/saas_chat_db

# Connection Pool Settings (optional)
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10
DATABASE_TIMEOUT=30000

# =============================================================================
# AI PROVIDERS
# =============================================================================

# OpenAI (REQUIRED for chat functionality)
OPENAI_API_KEY=sk-your-openai-api-key-here
OPENAI_ORG_ID=
OPENAI_MODEL=gpt-4
OPENAI_EMBEDDING_MODEL=text-embedding-3-small
OPENAI_MAX_TOKENS=4096
OPENAI_TEMPERATURE=0.7
OPENAI_TIMEOUT=60000

# Anthropic Claude (Optional)
ANTHROPIC_API_KEY=sk-ant-your-anthropic-api-key-here
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022
ANTHROPIC_MAX_TOKENS=4096
ANTHROPIC_TIMEOUT=60000

# Google AI (Optional - Gemini)
GOOGLE_AI_API_KEY=your-google-ai-api-key-here
GOOGLE_AI_MODEL=gemini-pro

# Groq (Optional - for fast inference)
GROQ_API_KEY=your-groq-api-key-here
GROQ_MODEL=llama2-70b-4096

# Cloudflare Workers AI (Optional - cost-optimized)
CLOUDFLARE_ACCOUNT_ID=your-cloudflare-account-id
CLOUDFLARE_API_TOKEN=your-cloudflare-api-token
CLOUDFLARE_AI_GATEWAY_ID=
CLOUDFLARE_AI_MODEL=@cf/meta/llama-2-7b-chat-int8

# Embedding Provider Selection (Optional - defaults to auto-select)
# Options: 'openai' | 'cloudflare' | leave empty for auto-selection
# Auto-selection: Uses Cloudflare if configured, otherwise OpenAI
# Recommendation: 'cloudflare' for FREE tier, 'openai' for PAID tier
EMBEDDING_PROVIDER=

# =============================================================================
# AUTHENTICATION
# =============================================================================
# For JWT verification (must match auth-service)
AUTH_SECRET=your-256-bit-secret-key-here-change-this-in-production

# =============================================================================
# FRONTEND & CORS
# =============================================================================
FRONTEND_URL=http://localhost:3000
CORS_ORIGIN=http://localhost:3000
CORS_CREDENTIALS=true

# =============================================================================
# MESSAGE QUEUE - RabbitMQ
# =============================================================================
# For publishing analytics events (REQUIRED)
RABBITMQ_URL=amqp://admin:admin@localhost:5672
RABBITMQ_EXCHANGE=analytics.events

# =============================================================================
# FILE UPLOAD & STORAGE
# =============================================================================
MAX_FILE_SIZE=10485760
ALLOWED_FILE_TYPES=image/jpeg,image/png,image/gif,application/pdf,text/plain
UPLOAD_DIR=/app/uploads

# AWS S3 (Optional)
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your-aws-access-key-id
AWS_SECRET_ACCESS_KEY=your-aws-secret-access-key
AWS_S3_BUCKET=your-s3-bucket-name

# Cloudflare R2 (Optional - preferred for free egress)
CLOUDFLARE_R2_ACCOUNT_ID=your-cloudflare-r2-account-id
CLOUDFLARE_R2_ACCESS_KEY_ID=your-r2-access-key-id
CLOUDFLARE_R2_SECRET_ACCESS_KEY=your-r2-secret-access-key
CLOUDFLARE_R2_BUCKET=your-r2-bucket-name

# =============================================================================
# CACHING & PERFORMANCE
# =============================================================================
CACHE_TTL_DEFAULT=3600
SUMMARY_CACHE_TTL=604800
EMBEDDING_CACHE_TTL=2592000
RAG_CACHE_TTL=3600

MAX_CONTEXT_MESSAGES=10
MAX_RAG_RESULTS=5
MAX_SUMMARY_LENGTH=500

# =============================================================================
# MONITORING & OBSERVABILITY (Optional)
# =============================================================================

# Sentry Error Tracking
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.1
SENTRY_DEBUG=false

# Jaeger Distributed Tracing
JAEGER_AGENT_HOST=localhost
JAEGER_AGENT_PORT=6831
JAEGER_SAMPLER_TYPE=probabilistic
JAEGER_SAMPLER_PARAM=0.1
JAEGER_SERVICE_NAME=chat-service

# Prometheus Metrics
PROMETHEUS_ENABLED=false
PROMETHEUS_PORT=9090

# =============================================================================
# RATE LIMITING
# =============================================================================
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# =============================================================================
# FEATURE FLAGS
# =============================================================================
FEATURE_CHAT_ENABLED=true
FEATURE_SUMMARIZER_ENABLED=true
FEATURE_RAG_ENABLED=true

# =============================================================================
# NOTES
# =============================================================================
# - This service handles: AI chat, document processing, embeddings
# - Required: DATABASE_URL, OPENAI_API_KEY, AUTH_SECRET
# - Optional: Other AI providers (Anthropic, Google, Groq, Cloudflare)
# - Publishes usage events to RabbitMQ for analytics
# - See docs/CONFIGURATION.md for complete reference
